<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" />
    <meta content="物不可以穷也，故受之以未济" name="description" />
    <meta content="web development, programming, typeface, typography" name="keywords" />
    <meta content="karottc" name="author" />
    <link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" />
    <link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
    <link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
    <link href="/manifest.json" rel="manifest" />
    <link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon" />
    <meta content="#ffffff" name="theme-color" />
    <title>杂思未济</title>
    <link href="/static/dist/semantic-ui/semantic.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/dist/fonts.css/fonts.css" rel="stylesheet" type="text/css" />
    <link href="/static/stylesheet/default.css" rel="stylesheet" type="text/css" />
    <link href="/static/stylesheet/pandoc-code-highlight.css" rel="stylesheet" type="text/css" />
    <script src="/static/dist/jquery/jquery.min.js"></script>
  </head>
  <body lang="cn">
    <div data-quotes-cn="[{&quot;content&quot;:[&quot;天上星，亮晶晶，永灿烂，长安宁。&quot;,&quot;湖边竹，盈盈绿，报平安，多喜乐。&quot;],&quot;author&quot;:&quot;金庸&quot;,&quot;from&quot;:&quot;天龙八部&quot;},{&quot;content&quot;:[&quot;死亡是唯一一座永远亮着的灯塔，不管你向哪里航行，最终都得转向它指引的方向。一切都会逝去，只有死神永生。&quot;],&quot;author&quot;:&quot;刘慈欣&quot;,&quot;from&quot;:&quot;地球往事&quot;},{&quot;content&quot;:[&quot;我终于明白了为什么 Einstein 喜爱看守灯塔的职业，因为那样他可以在自己的心灵中建立一片宁静而自由的天空。&quot;],&quot;author&quot;:&quot;卢昌海&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://www.changhai.org\&quot;&gt;http://www.changhai.org&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;我宁愿游荡在你身边&quot;,&quot;做七天的野鬼&quot;,&quot;跟随你&quot;,&quot;就算落进最黑暗的地方&quot;,&quot;我的爱&quot;,&quot;也不会让我成为永远的孤魂&quot;],&quot;author&quot;:&quot;李安&quot;,&quot;from&quot;:&quot;卧虎藏龙&quot;},{&quot;content&quot;:[&quot;在中国，任何超脱飞扬的思想都会砰然坠地——现实的引力实在是太沉重了。&quot;],&quot;author&quot;:&quot;刘慈欣&quot;,&quot;from&quot;:&quot;地球往事&quot;},{&quot;content&quot;:[&quot;天下唯庸人无咎无誉。&quot;],&quot;author&quot;:&quot;梁启超&quot;,&quot;from&quot;:&quot;李鸿章传&quot;}]" data-quotes-en="[{&quot;content&quot;:[&quot;Pascal is for building pyramids—imposing, breathtaking, static structures built by armies pushing heavy blocks into place. Lisp is for building organisms—imposing, breathtaking, dynamic structures built by squads fitting fluctuating myriads of simpler organisms into place.&quot;],&quot;author&quot;:&quot;Alan J. Perlis&quot;,&quot;from&quot;:&quot;foreword for &lt;a href=\&quot;http://mitpress.mit.edu/sicp/\&quot;&gt;SICP&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;When you don&#39;t create things, you become defined by your tastes rather than ability. Your tastes only narrow &amp; exclude people. So create.&quot;],&quot;author&quot;:&quot;why the luck stiff&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://whymirror.github.io/\&quot;&gt;http://whymirror.github.io/&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;In theory, there is no difference between theory and practice. But, in practice, there is.&quot;],&quot;author&quot;:&quot;Jan L. A. van de Snepscheut&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://en.wikiquote.org/wiki/Jan_L._A._van_de_Snepscheut\&quot;&gt;Wikipedia&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;The future has already arrived. It is just not evenly distributed yet.&quot;],&quot;author&quot;:&quot;William Gibson&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;https://en.wikiquote.org/wiki/William_Gibson\&quot;&gt;Wikiquote&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;There are many ways of trying to understand programs. People often rely too much on one way, which is called \&quot;debugging\&quot; and consists of running a partly-understood program to see if it does what you expected. Another way, which ML advocates, is to install some means of understanding in the very programs themselves.&quot;],&quot;author&quot;:&quot;Robin Milner&quot;,&quot;from&quot;:&quot;foreword for &lt;a href=\&quot;http://www.ccs.neu.edu/home/matthias/BTML/\&quot;&gt;The Little MLer&lt;/a&gt;&quot;}]" id="quotes" style="display: none"></div>
    <div id="content">
      <nav class="ui borderless menu desktop" lang="en">
        <div class="ui container">
          <a class="item" href="/"><img src="/static/image/gravatar-black.svg" /></a><a class="item" href="/archive">Archive</a><a class="item" href="/categories">Categories</a><a class="item" href="/tags">Tags</a><a class="item" href="/about">About</a>
          <div class="right menu">
            <div class="item">
              <form action="https://www.google.com/search" class="ui form" method="get" target="_blank">
                <input name="q" type="hidden" value="site:blog2.karottc.com" />
                <div class="ui transparent left icon input">
                  <input name="q" placeholder="Search..." type="text" /><i class="search icon"></i>
                </div>
              </form>
            </div>
            <a class="item" href="https://github.com/karottc"><i class="github icon"></i></a><a class="item" href="/atom.xml"><i class="feed icon"></i></a>
          </div>
        </div>
      </nav>
      <nav class="ui borderless menu mobile" lang="en">
        <div class="ui container">
          <a class="item" href="/"><img src="/static/image/gravatar-black.svg" /></a><a class="item" href="/archive">Archive</a><a class="item" href="/about">About</a>
          <div class="right menu">
            <a class="item" href="https://github.com/karottc/"><i class="github icon"></i></a>
          </div>
        </div>
      </nav><div class="ui stackable container">
  <div class="ui very padded segment article">
    <article class="ui stackable divided grid">
      <header class="row article-head">
        <div class="column">
          <h1 class="ui header">
            杂思未济
          </h1>
          <div class="ui divider desktop"></div>
        </div>
      </header>
      <div class="row article-body">
        <section class="eleven wide column">
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2017-08-25-play-king-of-glory-9-months/">我玩王者荣耀这九个月</a>
              <div class="sub header">
                2017-08-25
              </div>
            </h2>
            <p>从去年12月份（准确的时间是：2016.12.01）开始玩王者荣耀，到现在也差不多9个月了，从最开始的狂热，到现在淡漠。所以今天就来回顾一下，谈谈得失，梳理一下心路历程的变化。</p>
            <figure>
            <img src="/static/images/2017/20170825_game_01.JPG" alt="最高段位" /><figcaption>最高段位</figcaption>
            </figure>
            <p>都过去九个月了，已经不记得当时是由于什么原因开始玩这个游戏了，只记得在一个黄昏，下载了游戏，然后趁着吃晚饭的时间，过完了新手教程，然后买了两个英雄开始玩，当时前一周依然不不会玩（比如不知道应该走哪条线，不看小图等等），都是瞎玩，这种状态下每天都玩了好几局，现在回过头看，也没想通当时哪里来的动力玩这么多，因为完全是抓瞎状态，也体会不到游戏的乐趣才是。</p>
            
            <div class="ui small basic button">
              <a href="/posts/2017-08-25-play-king-of-glory-9-months/">Read More…</a>
            </div>
          </div>
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2015-06-19-push-2M-messages/">给两百万用户推送消息</a>
              <div class="sub header">
                2015-06-19
              </div>
            </h2>
            <p>我们新版app上线了，由于这次是一个大的改版，所以希望所有用户都升级到新版本，所以，一方面我们会在后台做一些限制来强制升级，另一方面我们也会推送介绍新版的消息给用户，也顺便提醒一些不活跃的用户。当然，做这些事都是要尽量保证用户体验，所以，对于那些已经升级到新版本的用户，就不应该再收到我们推送的消息了。</p>
            <p>因此，根据一些策略过滤之后，大概还有210万的用户需要推送消息，这么大的量没法手动操作，只能用程序来搞定了。很久以前我对这些数量其实并没有多大感知，但是最近接触的多了也就知道，数量大了之后就会有一些问题，比如服务的稳定性就需要考虑进去了，推送10个人可能一秒钟都不到，但是这百万量级，可能就需要几个小时了，这种推送时间太长肯定也是不能接受的。（比如昨天，我给一些用户补标，数量大概在500万左右，因为我考虑到不是很急，所以就只用了一个进程来跑，结果整整跑了24小时才结束，虽然是不急，但是这个时间也是太长了，还是自己的考虑欠缺，因为在运行之前并没有通过计算去预估它的时间）</p>
            <p>这次首先就考虑到了redis的读写压力，网络请求的速率等等情况，然后是准备在这边的调用方来限速，避免对后端的服务造成压力来保证服务的可靠，因为当时做这个后端服务接口的时候，主要就是给运营人员推送消息用的，而运营的消息，一天最多一条或者很多天才一条，因为消息多了会让用户反感。所以也就没考虑到会有这种场景，段时间内几百万的量，因此也就没有做压力测试，不知道上限在哪里，现在也就只能根据经验猜测，然后在调用端限制调用频率。不过，我先用了10个测试帐号，来具体看看，推送每个用户大概需要多少时间，然后发现每个用户的耗时在72~75毫秒的样子，这样1秒钟可以推送14个用户，1分钟可以到840～900个用户的样子，我用10个并发来进行，也就可以达到1分钟推送8400～9000个用户，所以200万的用户，大概需要220～240分钟，差不多4个小时。这个并发量对后端服务来说基本是可以的，虽然时间还是有点长，但也只能先这样了。</p>
            <p>同样的我先启动了2个进程，看看服务是否稳定，在看上去没有问题，各个监控也都正常，然后就放开了10个进程，当然，请求量自然一下就上来了，同样的先上图： <img src="/static/images/201501/20150619-message1.png" alt="监控图" /> 图中大概可以看到10个进程的请求量每分钟大概在11000～12000的样子，比上面预计的要快一些，同时也可以看到图里面，平时的请求量都只有几十的样子，现在突然升到1万以上，所以那些几十的曲线基本不可见了，那我把箭头处的曲线图放大来瞧瞧： <img src="/static/images/201501/20150619-message2.png" alt="监控图" /></p>
            
            <div class="ui small basic button">
              <a href="/posts/2015-06-19-push-2M-messages/">Read More…</a>
            </div>
          </div>
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2014-11-30-prevent-douban-ad/">去除豆瓣广告</a>
              <div class="sub header">
                2014-11-30
              </div>
            </h2><p>偶然发现一个可以去除豆瓣广告的方法，下面先看豆瓣主页的两处广告：<br /> <img src="/static/images/201406/20141130_douban1.png" alt="豆瓣广告" /> <img src="/static/images/201406/20141130_douban2.png" /></p>
<p>把鼠标放在广告上的时候，浏览器下面就能看到链接的地址信息，同时，如果点看网页的源码，也可以更明显看到广告加载的信息，如下图<br/></p>
<figure>
<img src="/static/images/201406/20141130_douban3.png" alt="豆瓣广告源码" /><figcaption>豆瓣广告源码</figcaption>
</figure>
<p>上面的图中都有一个 <code>http://erebor.douban.com/</code> 的网址，所以去除广告的方法就很简单了，只要把 <code>erebor.douban.com</code> 这个域名重定向到本地（即 <code>127.0.0.1</code>）就搞定<sup><a href="#fn:1" name="fnref:1">1</a></sup>。</p>

            <div class="ui small basic button">
              <a href="/posts/2014-11-30-prevent-douban-ad/">Read More…</a>
            </div>
          </div>
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2014-09-19-two-world-edge/">【书摘】站在两个世界的边缘</a>
              <div class="sub header">
                2014-09-19
              </div>
            </h2>
            <figure>
            <img src="/static/images/201406/20140919_world_edge.png" alt="站在两个世界的边缘" /><figcaption>站在两个世界的边缘</figcaption>
            </figure>
            <p>本文是<a href="http://book.douban.com/subject/25735727/">《站在两个世界的边缘》</a><sup><a href="#fn:1" name="fnref:1">1</a></sup>的一些书摘： &gt; 纵然你是一代天骄，坐拥天下，到头来不过化作一抔黄土； &gt; &gt; 纵然你是绝代佳人，艳冠群芳，到头来不过是一具白骨。 &gt; &gt; 但是，难道因为死亡是人生的终点，我们就要放弃生命的过程吗？ &gt; &gt; ——程浩</p>
            <blockquote>
            <p>在其诸多散杂的文字中，有一份2013的年度计划清单：</p>
            <p>1、阅读10部关于西方哲学的著作</p>
            <p>2、阅读儒、墨、道、法等学派的主要著作</p>
            <p>3、阅读各类畅销书50部</p>
            <p>4、学习新概念英语全四册</p>
            <p>5、学习英语500小时（共1000小时）</p>
            <p>6、写下50份读书笔记+思维导图</p>
            <p>7、写下50部短篇小说</p>
            <p>8、写下一部长篇小说</p>
            <p>……</p>
            <p>他让我们感受到生命的力量。</p>
            </blockquote>
            
            <div class="ui small basic button">
              <a href="/posts/2014-09-19-two-world-edge/">Read More…</a>
            </div>
          </div>
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2014-09-07-maximum-consecutive-subsequence/">归纳法求解最大连续子序列</a>
              <div class="sub header">
                2014-09-07
              </div>
            </h2>
            <p>求最大连续子序列的问题描述如下：</p>
            <blockquote>
            <p>给定一个实数序列 x<sub>1</sub>, x<sub>2</sub>, … , x<sub>n</sub>（不必是正数），寻找一个（连续的）子序列 x<sub>i</sub>, x<sub>i+1</sub>, … , x<sub>j</sub>，使得其数值之和在所有连续子序列数值之和中是最大的。</p>
            </blockquote>
            <p>这个问题就是最大子序列问题，所求的的这个序列就叫做——<em>最大子序列</em>。下面通过数学归纳法来分析和解决这个问题，解决这个问题的最好目标是： <strong>一个算法，能够只扫描此序列一次就得到最大子序列</strong>。</p>
            
            <div class="ui small basic button">
              <a href="/posts/2014-09-07-maximum-consecutive-subsequence/">Read More…</a>
            </div>
          </div>
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2014-09-03-life-meaning/">【解惑】人生有何意义</a>
              <div class="sub header">
                2014-09-03
              </div>
            </h2>
            <p>这几天看胡适的书，其中有一篇写到在民国八年的时候，胡适当年的同学朱子平问了他一个问题：“人生在世，究竟是为什么的？” 胡适当时的回答就是：“这个问题是没有答案的…….”</p>
            <p>然而在民国十七年一月二十七日，胡适又写了一篇，清楚的回答了这个问题： &gt; “人生有何意义？” &gt; &gt; 其实这个问题是容易解答的。人生的意义全是各人自己寻出来，造出来的：高尚，卑劣，清贵，污浊，有用，无用，……全靠自己的作为。生命本身不过是一件生物学的事实，有什么意义可说？生一个人与一只猫，一只狗，有什么分别？人生的意义不在于何以有生，而在于自己怎样生活。你若情愿把这六尺之躯葬送在白昼作梦之上，那就是你这一生的意义。你若发愤振作起来，决心去寻求生命的意义，去创造自己的生命的意义，那么，你活一日便有一日的意义，作一事便添一事的意义，生命无穷，生命的意义也无穷了。 &gt; &gt; 总之，生命本没有意义，你要能给他什么意义，他就有什么意义。与其终日冥想人生有何意义，不如试用此生作点有意义的事。……</p>
            <p>这个问题我也思考过，始终没有一个好的答案，今日读到此篇，感到万分惭愧，九十年前的人就已经给出了这个很好的答案了。</p>
            
            <div class="ui small basic button">
              <a href="/posts/2014-09-03-life-meaning/">Read More…</a>
            </div>
          </div>
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2014-08-31-evernote-wiz/">习惯的力量——从evernote试用为知笔记</a>
              <div class="sub header">
                2014-08-31
              </div>
            </h2>
            <p>从开始用<a href="http://wiz.cn/" title="为知笔记主页">为知笔记</a>这个程序到现在，有一周+的时间了，在此之前，我一直用的<a href="https://evernote.com/" title="evernote国际版主页，还有国内版!">evernote</a>，可以说我的生活中evernote已经变得非常重要，其重要的程度甚至使我从Linux转向了使用mac os，就因为mac os平台有evernote的客户端。去用为知笔记的起因是源于同学的推荐，了解了一下以后就装了一个来用，最吸引我一点是相比于evernote的免费用户，它的月流量是evernote的10倍，并且而已在移动设备上离线查看笔记，这些都是evernote的收费功能。</p>
            <p>为了深度的使用它，我首先导入了一小部分以前evernote的笔记，并且在有需求的时候我的第一解决方案都是优先考虑使用为知笔记，可以使用了这么久了，还是有很多不满意的地方，当然这些都是细节的地方，也许不是它做的不好，而是我用了几年的evernote已经习惯了而已，所以用其他的就会有对比，<strong>这就是习惯的力量，习惯的东西会化成生活中的不知不觉的一部分，让人无法抗拒，自然而然的会提高效率</strong>。</p>
            <p>虽然这界面初看上去不会有太大的差别，下面这是为知笔记的一个截图：<br /> <img src="/static/images/201406/20140829_wiz.png" alt="Wiz" /> 然后这是evernote的一个截图：<br /> <img src="/static/images/201406/20140829_evernote.png" alt="Evernote" /> 关键还是在体验和细节上，因为具体使用的时候就是一些琐碎操作，不然搜索、编辑、查看、响应鼠标的滚动速度、以及对网页剪辑的还原度等等。这是说一个我不习惯的地方：为知笔记的里面的超链接，鼠标点击后是在为知笔记自己的程序中打开网页，而evernote是调用系统的浏览器来打开网页，明显我更喜欢或者说更习惯与evernote这种方式。</p>
            
            <div class="ui small basic button">
              <a href="/posts/2014-08-31-evernote-wiz/">Read More…</a>
            </div>
          </div>
          <div class="ui vertical segment">
            <h2 class="ui header">
              <a href="/posts/2014-07-10-eight-queens-puzzle/">八皇后问题——Python简单解法</a>
              <div class="sub header">
                2014-07-10
              </div>
            </h2><blockquote>
<p>八皇后问题是一个以国际象棋为背景的问题：如何能够在8×8的国际象棋棋盘上放置八个皇后，使得任何一个皇后都无法直接吃掉其他的皇后？为了达到此目的，任两个皇后都不能处于同一条横行、纵行或斜线上。八皇后问题可以推广为更一般的n皇后摆放问题：这时棋盘的大小变为n×n，而皇后个数也变成n。当且仅当n = 1或n ≥ 4时问题有解。</p>
</blockquote>
<p>关于这个问题更详细的描述可以参见维基百科<sup><a href="#fnref:1" name="fnref:1">1</a></sup> ，使用Python的生成器（即含有yield语句的函数）来解这个问题就会变得很简单，15行以内python代码就可以解决这个问题，对于皇后的个数 n &lt; 8 来说还是非常快的，只是当数量上升到很多的时候，这个解法就会非常的慢。不过这里仍然只讨论最简单的解法，后面会顺便提一下更高效的解法，比如<font color="red">16</font>个皇后的情况在我的机器上只需要<font size="5px" color="red">18</font>秒。</p>
<p>下面是这个解法的完整的代码：</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="kw">def</span> conflict(state, nextX):
    nextY <span class="op">=</span> <span class="bu">len</span>(state)
    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nextY):
        <span class="cf">if</span> <span class="bu">abs</span>(state[i] <span class="op">-</span> nextX) <span class="kw">in</span> (<span class="dv">0</span>, nextY <span class="op">-</span> i):
            <span class="cf">return</span> <span class="va">True</span>
    <span class="cf">return</span> <span class="va">False</span>

<span class="kw">def</span> queens(num<span class="op">=</span><span class="dv">8</span>, state<span class="op">=</span>()):
    <span class="cf">for</span> pos <span class="kw">in</span> <span class="bu">range</span>(num):
        <span class="cf">if</span> <span class="kw">not</span> conflict(state, pos):
            <span class="cf">if</span> <span class="bu">len</span>(state) <span class="op">==</span> num <span class="op">-</span> <span class="dv">1</span> :
                <span class="cf">yield</span> (pos,)
            <span class="cf">else</span>:
                <span class="cf">for</span> result <span class="kw">in</span> queens(num, state<span class="op">+</span>(pos,)):
                    <span class="cf">yield</span> (pos,) <span class="op">+</span> result</code></pre></div>

            <div class="ui small basic button">
              <a href="/posts/2014-07-10-eight-queens-puzzle/">Read More…</a>
            </div>
          </div>
          <div class="ui one item menu">
            <a class="item" href="/archive">Posts Archive</a>
          </div>
        </section>
        <aside class="five wide column desktop">
          <blockquote class="words-cn"></blockquote>
        </aside>
      </div>
    </article>
  </div>
</div>
    </div>
    <div id="footer">
      <footer class="ui inverted vertical center aligned footer segment desktop">
        <div class="ui container">
          <p>
            Copyright © 2018–2018 by karottc — Powered by Emacs, Git, Pandoc, Ruby and Nanoc.
          </p>
        </div>
      </footer>
      <footer class="ui inverted vertical center aligned footer segment mobile">
        <div class="ui container">
          <p>
            Copyright © 2018–2018 by karottc
          </p>
        </div>
      </footer>
      <script src="/static/dist/semantic-ui/semantic.min.js"></script>
      <script src="/static/javascript/ga.js"></script>
      <script src="/static/javascript/default.js"></script>
    </div>
  </body>
</html>